<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title> Jumpy!!! </title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@v3.80.1/dist/phaser.js"></script>


    <style type="text/css">
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #A9A9A9
        }
    </style>
</head>
<body>
    <div id="game-container">
        <script type="text/javascript">

            var config = {
                type: Phaser.AUTO,
                width: 400,
                height: 2700,
                parent: "game-container",
                physics: {
                    default: 'arcade',
                    arcade: {
                        gravity: { y: 300},
                        debug: false
                    }
                },
                scene: {
                    preload: preload,
                    create: create,
                    update: update
                }
            };

            var game = new Phaser.Game(config);
            var score = 0;
            var cursor;
            let swipe = {
                started: false,
                start: { x: 0, y: 0 },
                end: { x: 0, y: 0 }
            };


            function preload() {
                this.load.image('bg', 'Assets/bg.png');
                this.load.image('wood', 'Assets/wood.png');
                this.load.image('jumpy', 'Assets/jumpy.png');
                this.load.spritesheet('enemy', 'Assets/enemy.png', { frameWidth: 50, frameHeight: 50 })
                this.load.image('go_bg', 'Assets/black_screen.jpg');
                this.load.audio('music', 'Assets/music.mp3');
                this.load.audio('jump', 'Assets/jump.mp3');
                this.load.audio('death', 'Assets/death.mp3');
            }

            var platforms;
            var player_spawn = Math.floor(Math.random() * 317);
            var player;
            var bg;
            var bg2;
            var bg3;
            var bg4;
            var bg5;
            var go_bg;
            var go_txt;
            var go_txt2;
            var go_txt3;
            var death_music;
            var music;
            var jump_music;
            var camera;
            let swipeDirection = '';

            function create() {
                bg5 = this.add.image(200, 2700, 'bg')
                bg4 = this.add.image(200, 2100, 'bg')
                bg3 = this.add.image(200, 1500, 'bg')
                bg2 = this.add.image(200, 900, 'bg')
                bg = this.add.image(200, 300, 'bg')

                platforms = this.physics.add.staticGroup();

                player = this.physics.add.sprite(player_spawn, 2650, 'jumpy').setScale(2);

                platforms.create(player_spawn, 2650, 'wood').setScale(0.1).refreshBody();

                camera = this.cameras.main;
                camera.startFollow(player);
                camera.setBounds(0, 0, game.config.width, Infinity);

                cursor = this.input.keyboard.createCursorKeys();
                cursor.a = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A);
                cursor.d = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
                cursor.space = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);

                this.input.on('pointerdown', function (pointer) {
                    swipe.started = true;
                    swipe.start.x = pointer.x;
                    swipe.start.y = pointer.y;

                }, this);

                this.input.on('pointerup', function (pointer) {
                    swipe.started = false;
                    swipe.end.x = pointer.x;
                    swipe.end.y = pointer.y;

                    if (swipe.end.x - swipe.start.x > 0) {
                        swipeDirection = 'right';
                    } else if (swipe.end.x - swipe.start.x < 0) {
                        swipeDirection = 'left';
                    }
                }, this);

                death_music = this.sound.add('death');
                music = this.sound.add('music');
                music.play();
                jump_music = this.sound.add('jump');
            }

            var platforms_counter = 0;
            game_over = false;
            var dx = 0;

            function update() {

                if (player.y < camera.y) {
                    camera.y = player.y;
                }

                if (cursor.a.isDown || cursor.left.isDown || swipeDirection == 'left') {
                    if (swipeDirection == 'left') {
                        this.tweens.add({
                            targets: player,
                            x: player.x - 50,
                            duration: 100,
                            ease: 'Linear'
                        });
                    }
                    else{
                        dx = -5;
                    }
                    player.flipX = true;
                } else if (cursor.d.isDown || cursor.right.isDown || swipeDirection == 'right') {
                    if (swipeDirection == 'right'){
                        this.tweens.add({
                            targets: player,
                            x: player.x + 50,
                            duration: 100,
                            ease: 'Linear'
                        });
                    }
                    else {
                        dx = 5;
                    }
                    player.flipX = false;
                } else {
                    dx = 0;
                }

                player.x += dx;
                swipeDirection = '';

                if (player.body.velocity.y > 0) {
                    this.physics.world.collide(player, platforms, function () {
                        player.setVelocityY(-300);
                        jump_music.play();
                    });
                } else {
                    this.physics.world.removeCollider(player, platforms);
                }

                if (player.x > 367) {
                    player.x = 367;
                }

                if (player.x < 33) {
                    player.x = 33;
                }

                while (platforms_counter < 100) {
                    var x = Math.floor(Math.random() * 317);
                    var platform_spawn = Math.floor(Math.random() * 2550);
                    platforms.create(x, platform_spawn, 'wood').setScale(0.1).refreshBody();
                    platforms_counter++;
                }

                platforms.children.iterate(function (child) {
                    if (child) {
                        if (child.y > game.config.height) {
                            child.destroy();
                            platforms_counter--;
                        }
                    }
                });

                if (player.y > game.config.height) {
                    death_music.play();
                    game_over = true;
                }

                if (game_over == true) {
                    camera.setBounds(0, 0, game.config.width, game.config.height);
                    this.physics.pause();
                    bg = this.add.image(200, 300, 'go_bg')
                    go_txt = this.add.text(110, 200, 'Game Over', {fontSize: '32px', fill: '#ffffff'});
                    go_txt2 = this.add.text(135, 250, 'Score: ' + score, {fontSize: '25px', fill: '#ffffff'});
                    go_txt3 = this.add.text(25, 350, 'Press anywhere on the screen to restart', {
                        fontSize: '15px',
                        fill: '#ffffff'
                    });
                    if (this.input.activePointer.isDown || cursor.space.isDown) {
                        go_txt.destroy();
                        game_over = false;
                        this.scene.restart();
                        platform_counter = 0;
                    }
                }
            }

        </script>

    </div>

</body>
</html>